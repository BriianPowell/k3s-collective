apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: alertmanager-config
  namespace: monitoring
spec:
  # global:
  #   smtp_from:
  #   smtp_auth_username:
  #   smtp_auth_password:
  #     valueFrom:
  #       secretKeyRef:
  #         name: alertmanager-secrets
  #         key: SMTP_PASS
  # templates:
  #   - '/etc/alertmanager/*.tmpl'
  route:
    receiver: alert-emailer
    groupBy: ['alertname', 'priority']
    groupWait: 30s
    repeatInterval: 10m
    # routes:
    #   - receiver: slack_demo
    #   # Send severity=slack alerts to slack.
    #     match:
    #       severity: slack
    #     group_wait: 10s
    #     repeat_interval: 1m
  receivers:
    - name: alert-emailer
      emailConfigs:
        - to: brian@powell.place
          from:
            valueFrom:
              secretKeyRef:
                name: alertmanager-secrets
                key: SMTP_FROM
          sendResolved: true
          requireTLS: true
          smarthost: smtp.mail.me.com:587
          authPassword:
            key: SMTP_PASS
            name: alertmanager-secrets
          authUsername:
            valueFrom:
              secretKeyRef:
                name: alertmanager-secrets
                key: SMTP_USER
  # - name: slack_demo
  #   slack_configs:
  #   - api_url: https://hooks.slack.com/services/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sz4Qk
  #     channel: '#devopscube-demo'
