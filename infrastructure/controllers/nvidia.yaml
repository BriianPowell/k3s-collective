# #
# # Reference:
# # https://nixos.wiki/wiki/K3s#Nvidia_support
# # https://docs.k3s.io/advanced#nvidia-container-runtime-support
# # https://github.com/NVIDIA/k8s-device-plugin?tab=readme-ov-file#updating-per-node-configuration-with-a-node-label
# #

# apiVersion: source.toolkit.fluxcd.io/v1beta2
# kind: HelmRepository
# metadata:
#   name: nvidia
#   namespace: kube-system
# spec:
#   interval: 24h
#   url: https://nvidia.github.io/k8s-device-plugin
# ---
# apiVersion: helm.toolkit.fluxcd.io/v2beta1
# kind: HelmRelease
# metadata:
#   name: nvidia-device-plugin
#   namespace: kube-system
# spec:
#   interval: 1h0m0s
#   chart:
#     spec:
#       chart: nvidia-device-plugin
#       sourceRef:
#         kind: HelmRepository
#         name: nvidia
#         namespace: kube-system
#       version: '>=0.15.0 <0.16.0'
#   values:
#     config:
#       map:
#         default: |-
#           version: v1
#           flags:
#             migStrategy: 'none'
#             failOnInitError: true
#             nvidiaDriverRoot: '/run/current-system/sw/bin'
#             plugin:
#               passDeviceSpecs: false
#               deviceListStrategy: envvar
#               deviceIDStrategy: uuid
#     migStrategy: none
#     failOnInitError: true
#     deviceListStrategy: envvar
#     deviceIDStrategy: uuid
#     nvidiaDriverRoot: '/run/current-system/sw/bin'
#     gdsEnabled: false
#     mofedEnabled: false
#     compatWithCPUManager: false
#     allowDefaultNamespace: false
#     runtimeClassName: nvidia
#     affinity:
#       nodeAffinity:
#         requiredDuringSchedulingIgnoredDuringExecution:
#           nodeSelectorTerms:
#             - matchExpressions:
#                 - key: kubernetes.io/hostname
#                   operator: In
#                   values:
#                     - sheol
#     gfd:
#       enabled: false
